from src.application.common.const import MINUTES_TO_SEND_GIFT
from src.domain.entities.market import OrderDM
from src.domain.entities.user import FullUserInfoDM


def get_buy_gift_text(type_name: str, gift_number: int) -> str:
    return (
        f"üí∞ Your gift was bought - <b>{type_name} #{gift_number}</b>"
    )


def get_cancel_gift_text(type_name: str, gift_number: int) -> str:
    return (
        f"‚ùó The buyer canceled the purchase of your gift - <b>{type_name} #{gift_number}</b>\n\n"
        "‚ö†Ô∏è <b>Don't transfer your gift! If the transfer has occurred, please contact support</b>"
    )


def get_seller_accept_text(type_name: str, gift_number: int) -> str:
    return (
        f"‚úÖ The seller accepted your deal for a gift - <b>{type_name} #{gift_number}</b>\n\n"
        f"üïë Wait for the seller to send you a gift and you will receive a notification in the bot"
    )


def get_seller_cancel_text(type_name: str, gift_number: int) -> str:
    return (
        f"‚ùå The seller canceled your gift order - <b>{type_name} #{gift_number}</b>\n\n"
        f"üí∏ The TONs have been returned to your balance in the app"
    )


def get_confirm_transfer_text(type_name: str, gift_number: int) -> str:
    return (
        f"‚úÖ The seller transferred you a gift - <b>{type_name} #{gift_number}</b>\n\n"
        "Go to the market and confirm receipt of the gift\n\n"
        "‚ö†Ô∏è <i>Be sure to check if you have received the gift for real!"
        "Check your profile, and only then confirm receipt!</i>"
    )


def get_accept_transfer_text(type_name: str, gift_number: int) -> str:
    return f"‚úÖ The order was completed successfully - <b>{type_name} #{gift_number}</b>"


def get_buy_stars_text(amount: float) -> str:
    return (
        f"üí∞ Your stars was bought - <b>{amount:.2f} ‚≠ê</b>\n\n"
        f"üì§ Confirm or cancel the order in the app"
    )


def get_cancel_star_text(amount: float) -> str:
    return (
        f"‚ùó The buyer canceled the purchase of your stars - <b>{amount:.2f} ‚≠ê</b>"
    )


def get_seller_accept_star_text(amount: float) -> str:
    return (
        f"‚úÖ The seller accepted your deal for a {amount:.2f} Stars\n\n"
        f"üïë Wait for the seller to send you a Stars and you will receive a notification in the bot"
    )


def get_seller_cancel_star_text(amount: float) -> str:
    return (
        f"‚ùå The seller canceled order for buy {amount:.2f} Stars\n\n"
        f"üí∏ The TONs have been returned to your balance in the app"
    )


def get_confirm_transfer_stars_text(amount: float) -> str:
    return (
        f"‚úÖ The seller transferred you {amount:.2f} Stars\n\n"
        "Go to the market and confirm receipt of the Stars\n\n"
        "‚ö†Ô∏è <i>Be sure to check if you have received the Stars for real!</i>"
    )


def get_accept_transfer_stars_text(amount: float) -> str:
    return f"‚úÖ The order for {amount:.2f} Stars was completed successfully"


def get_withdraw_request_text(username: str | None, user_id: int, amount: float, wallet: str) -> str:
    username_text = "" if not username else f"@{username} "
    return (
        f"üëõ –ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {username_text}#<code>{user_id}</code>"
        f"\n\n–°—É–º–º–∞: <b>{amount}</b> TON\n–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞: <code>{wallet}</code>"
    )


def get_start_text() -> str:
    return (
        "üéÅ <b>The best gift market in Telegram is already here!</b>\n\n"
        "üî• Buy and sell gifts quickly and securely!"
    )


def get_deposit_text(
    username: str | None, user_id: int, is_testnet: bool, ton_amount: float, hash: str
) -> str:
    user_data_text = f"{f'@{username}' if username else ''} #<code>{user_id}</code>"
    link_text = "testnet." if is_testnet else ""
    return (
        f"üí∏ {user_data_text.strip()} –ø–æ–ø–æ–ª–Ω–∏–ª –±–∞–ª–∞–Ω—Å –Ω–∞ {ton_amount} TON\n\n"
        f"üîó <b><a href='https://{link_text}tonviewer.com/transaction/{hash}'>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è</a></b>"
    )


def get_canceled_text_to_owner(username: str | None, user_id: int) -> str:
    username_text = "" if not username else f"@{username} "
    return (
        f"‚ùó –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {username_text}#<code>{user_id}</code> –æ—Ç–º–µ–Ω–∏–ª –ø–æ–∫—É–ø–∫—É –ø–æ–¥–∞—Ä–∫–∞!\n\n"
        "‚ö†Ô∏è –ï—Å–ª–∏ –æ–Ω —Å–æ–∑–¥–∞—Å—Ç –∑–∞—è–≤–∫—É –Ω–∞ –≤—ã–≤–æ–¥ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ–¥–∞–≤–µ—Ü –Ω–µ –ø–µ—Ä–µ–¥–∞–ª –µ–º—É –ø–æ–¥–∞—Ä–æ–∫"
    )


def get_admin_text(
    count_users: int, count_gifts: int, count_completed_gifts: int, total_balance: float
) -> str:
    return (
        f"<b>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</b>: {count_users}\n<b>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∞—Ä–∫–æ–≤</b>: {count_gifts}"
        f"\n<b>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫</b>: {count_completed_gifts}\n"
        f"<b>–û–±—â–∏–π –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: </b>{total_balance:.1f} TON"
    )


def get_seller_canceled_admin_text(user_id: int) -> str:
    return (
        f"‚ùó –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #<code>{user_id}</code> –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏–ª –ø–æ–¥–∞—Ä–æ–∫ –≤ —Ç–µ—á–µ–Ω–∏–µ {MINUTES_TO_SEND_GIFT} –º–∏–Ω—É—Ç. "
        "–°–¥–µ–ª–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞!"
        "\n\n‚ö†Ô∏è –ï—Å–ª–∏ —ç—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–∞—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —Å–¥–µ–ª–∫—É, "
        "–≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –æ—Ç–ø—Ä–∞–≤–∏–≤ <code>/ban [user id]</code>"
    )


def get_full_user_info_text(user_info_data: FullUserInfoDM) -> str:
    username_text = f"üë®‚Äçü¶± <b>Username</b>: <b>@{user_info_data.username}</b>\n"
    first_name_text = f"üóø <b>–ò–º—è</b>: <b>{user_info_data.first_name}</b>\n"
    if not user_info_data.username:
        username_text = ""
    if not user_info_data.first_name:
        first_name_text = ""

    orders_text = f"\nüõçÔ∏è <b>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞: </b>"
    for order in user_info_data.orders[:5]:
        user_text = "–ø–æ–∫—É–ø–∞—Ç–µ–ª—å" if order.buyer_id == user_info_data.id else "–ø—Ä–æ–¥–∞–≤–µ—Ü"
        completed_date_text = "\n"
        if order.completed_order_date:
            completed_date_text = f"\n<b>–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: </b>{order.completed_order_date}\n"
        orders_text += (
            f"\n<b>ID: </b>{order.id}\n<b>–ü–æ–¥–∞—Ä–æ–∫</b>:  <b>{order.type.name} #{order.number}</b>"
            f"\n<b>–¶–µ–Ω–∞: </b>{order.price} TON"
            f"\n<b>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: </b>{user_text}{completed_date_text}"
        )
    if not user_info_data.orders:
        orders_text = ""

    withdraws_text = f"\nüëõ <b>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–≤–æ–¥—ã:</b>"
    for withdraw in user_info_data.withdraw_requests[:5]:
        withdraws_text += f"\n<code>{withdraw.wallet}</code> - {withdraw.amount:.2f} TON"
    withdraws_text += "\n"
    if not user_info_data.withdraw_requests:
        withdraws_text = ""

    return (
        f"üîí ID: <code>{user_info_data.id}</code>\n"
        f"{username_text}"
        f"{first_name_text}"
        f"üí∞ <b>–ë–∞–ª–∞–Ω—Å: </b>{user_info_data.balance:.2f} TON\n"
        f"üìÖ <b>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: </b>{user_info_data.created_at.strftime("%d.%m.%y, %H:%M")}\n"
        f"{orders_text}"
        f"{withdraws_text}"
        f"\nüí∏ <b>–û–±—â–∞—è –≤—ã–≤–µ–¥–µ–Ω–Ω–∞—è —Å—É–º–º–∞: </b>{user_info_data.total_withdrawn} TON"
    )


def get_order_info_text(order_info: OrderDM) -> str:
    buyer_text = ""
    if order_info.buyer_id:
        buyer_text = f"üë®‚Äçü¶± <b>–ü—Ä–æ–¥–∞–≤–µ—Ü: </b>@{order_info.seller_id} #<code>{order_info.buyer_id}</code>\n"
    created_order_text = ""
    completed_order_text = ""
    if order_info.completed_order_date:
        completed_order_text = (
            f"üìÖ <b>–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–¥–µ–ª–∫–∏: </b>{order_info.completed_order_date.strftime("%d.%m.%y, %H:%M")}"
        )

    return (
        f"üîí ID: <code>{order_info.id}</code>\n"
        f"üîé –¢–∏–ø: <code>{order_info.type.name}</code>\n"
        f"‚ûï –ù–æ–º–µ—Ä: <code>{order_info.number}</code>\n"
        f"üí∞ <b>–¶–µ–Ω–∞: </b>{order_info.price} TON\n\n"
        f"{buyer_text}"
        f"üî¶ <b>–ú–æ–¥–µ–ª—å: </b>{order_info.model}%\n"
        f"‚ùÑÔ∏è <b>–§–æ–Ω: </b>{order_info.background}%\n"
        f"üéÉ <b>–£–∑–æ—Ä: </b>{order_info.pattern}%\n\n"
        f"{created_order_text}"
        f"{completed_order_text}"
    )
